# ğŸ›¢ï¸ Petrobras Offshore Wells Anomaly Detection - Project Specific Configuration
# =============================================================================

# =================================================================
# ğŸ¯ PROJECT-SPECIFIC ALIASES
# =================================================================

# Anomaly Detection Models
alias train-isolation='python src/models/isolation_forest.py'
alias train-lstm='python src/models/lstm_anomaly.py'
alias train-vae='python src/models/vae_anomaly.py'
alias train-usad='python src/models/usad.py'

# Data Processing
alias process-raw='python src/data/process_raw_data.py'
alias feature-eng='python src/features/feature_engineering.py'
alias validate-data='python src/data/validate_data.py'

# Evaluation
alias eval-model='python src/evaluation/evaluate_model.py'
alias plot-results='python src/visualization/plot_results.py'
alias generate-report='python src/reporting/generate_report.py'

# =================================================================
# ğŸ§ª EXPERIMENT FUNCTIONS
# =================================================================

# Quick experiment setup
quick_experiment() {
    local model_type=$1
    local data_file=$2

    if [ -z "$model_type" ] || [ -z "$data_file" ]; then
        echo "Usage: quick_experiment <model_type> <data_file>"
        echo "Model types: isolation, lstm, vae, usad"
        return 1
    fi

    local exp_name="quick_${model_type}_$(date +%Y%m%d_%H%M%S)"
    run_experiment "$exp_name"

    echo "ğŸ§ª Starting quick experiment with $model_type on $data_file"
    echo "ğŸ“Š Experiment: $exp_name"
    echo "ğŸ“ Data: $data_file"
}

# Batch experiment runner
batch_experiments() {
    local config_file=$1

    if [ -z "$config_file" ]; then
        echo "Usage: batch_experiments <config_file>"
        return 1
    fi

    echo "ğŸ”„ Running batch experiments from $config_file"
    python src/experiments/batch_runner.py --config "$config_file"
}

# =================================================================
# ğŸ“Š DATA FUNCTIONS
# =================================================================

# Data quality check
check_data_quality() {
    local data_path=$1

    if [ -z "$data_path" ]; then
        data_path="$DATA_DIR/raw"
    fi

    echo "ğŸ” Checking data quality in $data_path"
    python src/data/quality_check.py --data_path "$data_path"
}

# Data summary
data_summary() {
    local data_file=$1

    if [ -z "$data_file" ]; then
        echo "Usage: data_summary <data_file>"
        return 1
    fi

    echo "ğŸ“Š Generating data summary for $data_file"
    python src/analysis/data_summary.py --file "$data_file"
}

# =================================================================
# ğŸ¤– MODEL FUNCTIONS
# =================================================================

# Model comparison
compare_models() {
    local results_dir=$1

    if [ -z "$results_dir" ]; then
        results_dir="$LOGS_DIR/results"
    fi

    echo "âš–ï¸  Comparing models in $results_dir"
    python src/evaluation/compare_models.py --results_dir "$results_dir"
}

# Model deployment
deploy_model() {
    local model_path=$1
    local version=$2

    if [ -z "$model_path" ] || [ -z "$version" ]; then
        echo "Usage: deploy_model <model_path> <version>"
        return 1
    fi

    echo "ğŸš€ Deploying model $model_path version $version"
    python src/deployment/deploy_model.py --model_path "$model_path" --version "$version"
}

# =================================================================
# ğŸ“ˆ MONITORING FUNCTIONS
# =================================================================

# Start monitoring dashboard
start_monitoring() {
    echo "ğŸ“Š Starting monitoring dashboard..."

    # Start MLflow UI
    mlflow-ui &
    echo "ğŸ“ˆ MLflow UI: http://localhost:8000"

    # Start TensorBoard
    tensorboard &
    echo "ğŸ”¬ TensorBoard: http://localhost:6006"

    # Start Jupyter Lab
    jlab &
    echo "ğŸ““ Jupyter Lab: http://localhost:8888"

    echo "âœ… All monitoring tools started!"
}

# Stop monitoring
stop_monitoring() {
    echo "ğŸ›‘ Stopping monitoring tools..."
    pkill -f "mlflow ui"
    pkill -f "tensorboard"
    pkill -f "jupyter"
    echo "âœ… Monitoring tools stopped"
}

# =================================================================
# ğŸ”§ UTILITY FUNCTIONS
# =================================================================

# Backup data
backup_data() {
    local backup_name="backup_$(date +%Y%m%d_%H%M%S)"
    local backup_dir="$PROJECT_ROOT/backups/$backup_name"

    echo "ğŸ’¾ Creating backup: $backup_name"
    mkdir -p "$backup_dir"

    # Backup data
    cp -r "$DATA_DIR" "$backup_dir/"

    # Backup models
    cp -r "$MODELS_DIR" "$backup_dir/"

    # Backup configs
    cp -r "$CONFIG_DIR" "$backup_dir/"

    echo "âœ… Backup created at $backup_dir"
}

# Clean all temporary files
clean_all() {
    echo "ğŸ§¹ Cleaning all temporary files..."

    # Clean Python cache
    clean-pyc
    clean-cache

    # Clean logs
    clean-logs

    # Clean Jupyter checkpoints
    find . -name ".ipynb_checkpoints" -type d -exec rm -rf {} + 2>/dev/null || true

    # Clean temporary files
    find . -name "*.tmp" -delete 2>/dev/null || true
    find . -name "*.temp" -delete 2>/dev/null || true

    echo "âœ… All temporary files cleaned"
}

# =================================================================
# ğŸ¨ ENHANCED PROMPT FOR PROJECT
# =================================================================

# Enhanced prompt with project info
project_prompt() {
    local git_branch=$(git branch --show-current 2>/dev/null)
    local venv_status=$([ -n "$VIRTUAL_ENV" ] && echo "venv" || echo "")
    local mlflow_exp=$([ -n "$MLFLOW_EXPERIMENT_NAME" ] && echo "exp:$MLFLOW_EXPERIMENT_NAME" || echo "")

    echo "ğŸ›¢ï¸  Petrobras Anomaly Detection"
    echo "ğŸ“ $(pwd | sed "s|$PROJECT_ROOT|~|")"
    [ -n "$git_branch" ] && echo "ğŸŒ¿ Branch: $git_branch"
    [ -n "$venv_status" ] && echo "ğŸ $venv_status"
    [ -n "$mlflow_exp" ] && echo "ğŸ§ª $mlflow_exp"
    echo ""
}

# =================================================================
# ğŸš€ QUICK START FUNCTIONS
# =================================================================

# Quick start development environment
dev_start() {
    echo "ğŸš€ Starting development environment..."

    # Activate virtual environment
    activate_venv

    # Start monitoring
    start_monitoring

    # Show project status
    project_status

    echo "âœ… Development environment ready!"
}

# Quick stop development environment
dev_stop() {
    echo "ğŸ›‘ Stopping development environment..."

    # Stop monitoring
    stop_monitoring

    echo "âœ… Development environment stopped"
}

# =================================================================
# ğŸ“š HELP FUNCTIONS
# =================================================================

# Show project help
project_help() {
    echo "ğŸ›¢ï¸  Petrobras Offshore Wells Anomaly Detection - Help"
    echo "=================================================="
    echo ""
    echo "ğŸš€ Quick Start:"
    echo "  dev_start          - Start development environment"
    echo "  dev_stop           - Stop development environment"
    echo "  project_status     - Show project status"
    echo ""
    echo "ğŸ§ª Experiments:"
    echo "  quick_experiment   - Run quick experiment"
    echo "  batch_experiments  - Run batch experiments"
    echo "  run_experiment     - Start new experiment"
    echo ""
    echo "ğŸ“Š Data:"
    echo "  check_data_quality - Check data quality"
    echo "  data_summary       - Generate data summary"
    echo "  backup_data        - Backup project data"
    echo ""
    echo "ğŸ¤– Models:"
    echo "  compare_models     - Compare model performance"
    echo "  deploy_model       - Deploy model"
    echo ""
    echo "ğŸ“ˆ Monitoring:"
    echo "  start_monitoring   - Start monitoring tools"
    echo "  stop_monitoring    - Stop monitoring tools"
    echo "  monitor_training   - Show monitoring URLs"
    echo ""
    echo "ğŸ”§ Utilities:"
    echo "  clean_all          - Clean temporary files"
    echo "  project_help       - Show this help"
    echo ""
}

# =================================================================
# ğŸ¯ AUTO-COMPLETION
# =================================================================

# Auto-completion for project functions
_quick_experiment() {
    local cur=${COMP_WORDS[COMP_CWORD]}
    COMPREPLY=($(compgen -W "isolation lstm vae usad" -- "$cur"))
}

_batch_experiments() {
    local cur=${COMP_WORDS[COMP_CWORD]}
    COMPREPLY=($(compgen -f -X "!*.yaml" -- "$cur"))
}

# Register auto-completion
complete -F _quick_experiment quick_experiment
complete -F _batch_experiments batch_experiments

# =================================================================
# ğŸ‰ PROJECT WELCOME
# =================================================================

echo "ğŸ›¢ï¸  Petrobras Project Configuration Loaded!"
echo "ğŸ’¡ Use 'project_help' for available commands"
echo "ğŸš€ Use 'dev_start' to begin development"
echo ""
