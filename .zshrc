# =============================================================================
# üõ¢Ô∏è PETROBRAS OFFSHORE WELLS ANOMALY DETECTION - ZSH CONFIGURATION
# =============================================================================
# Configura√ß√£o personalizada para o projeto PIBIC de detec√ß√£o de anomalias
# em s√©ries temporais multivariadas de po√ßos offshore da Petrobras
# =============================================================================

# =============================================================================
# üöÄ CONFIGURA√á√ïES B√ÅSICAS DO ZSH
# =============================================================================

# Configura√ß√µes de hist√≥rico
HISTSIZE=10000
SAVEHIST=10000
HISTFILE=~/.zsh_history
setopt HIST_VERIFY
setopt SHARE_HISTORY
setopt APPEND_HISTORY
setopt INC_APPEND_HISTORY
setopt HIST_IGNORE_DUPS
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_REDUCE_BLANKS
setopt HIST_IGNORE_SPACE

# Configura√ß√µes de autocompletar
autoload -U compinit && compinit
setopt AUTO_LIST
setopt AUTO_MENU
setopt COMPLETE_IN_WORD
setopt ALWAYS_TO_END

# Configura√ß√µes de diret√≥rio
setopt AUTO_CD
setopt AUTO_PUSHD
setopt PUSHD_IGNORE_DUPS
setopt PUSHD_SILENT

# Configura√ß√µes de corre√ß√£o
setopt CORRECT
setopt CORRECT_ALL

# =============================================================================
# üé® PERSONALIZA√á√ïES DE APAR√äNCIA
# =============================================================================

# Cores personalizadas
export TERM="xterm-256color"

# Cores para ls
if [[ "$OSTYPE" == "linux-gnu"* ]]; then
    alias ls='ls --color=auto'
    alias ll='ls -alF --color=auto'
    alias la='ls -A --color=auto'
    alias l='ls -CF --color=auto'
elif [[ "$OSTYPE" == "darwin"* ]]; then
    alias ls='ls -G'
    alias ll='ls -alFG'
    alias la='ls -AG'
    alias l='ls -CFG'
fi

# Cores para grep
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'

# =============================================================================
# üêç CONFIGURA√á√ïES DO PYTHON E AMBIENTE
# =============================================================================

# Configura√ß√µes do Python
export PYTHONPATH="${PYTHONPATH}:$(pwd)/src"
export PYTHONPATH="${PYTHONPATH}:$(pwd)/notebooks"
export PYTHONUNBUFFERED=1
export PYTHONDONTWRITEBYTECODE=1

# Configura√ß√µes do uv (gerenciador de depend√™ncias)
export UV_SYSTEM_PYTHON=1
export UV_CACHE_DIR=~/.cache/uv

# Configura√ß√µes do Jupyter
export JUPYTER_CONFIG_DIR=~/.jupyter
export JUPYTER_DATA_DIR=~/.local/share/jupyter

# Configura√ß√µes do MLflow
export MLFLOW_TRACKING_URI="http://localhost:5000"
export MLFLOW_EXPERIMENT_NAME="petrobras-anomaly-detection"

# Configura√ß√µes do TensorBoard
export TENSORBOARD_LOG_DIR="./logs/tensorboard"

# =============================================================================
# üõ¢Ô∏è VARI√ÅVEIS DE AMBIENTE DO PROJETO PETROBRAS
# =============================================================================

# Configura√ß√µes do projeto
export PROJECT_NAME="petrobras-offshore-wells-anomaly-detection"
export PROJECT_ROOT="$(pwd)"
export DATA_DIR="${PROJECT_ROOT}/data"
export MODELS_DIR="${PROJECT_ROOT}/models"
export NOTEBOOKS_DIR="${PROJECT_ROOT}/notebooks"
export SRC_DIR="${PROJECT_ROOT}/src"
export LOGS_DIR="${PROJECT_ROOT}/logs"
export CONFIG_DIR="${PROJECT_ROOT}/config"

# Configura√ß√µes de dados
export RAW_DATA_DIR="${DATA_DIR}/raw"
export PROCESSED_DATA_DIR="${DATA_DIR}/processed"
export FEATURES_DATA_DIR="${DATA_DIR}/features"
export RESULTS_DATA_DIR="${DATA_DIR}/results"

# Configura√ß√µes de modelos
export MODEL_BATCH_SIZE=32
export MODEL_LEARNING_RATE=0.001
export MODEL_EPOCHS=100
export MODEL_VALIDATION_SPLIT=0.2
export MODEL_PATIENCE=10

# Configura√ß√µes de logging
export LOG_LEVEL="INFO"
export ENABLE_TENSORBOARD=true
export ENABLE_MLFLOW=true

# Configura√ß√µes de GPU (se dispon√≠vel)
export CUDA_VISIBLE_DEVICES=0
export PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:512

# =============================================================================
# üîß ALIASES ESPEC√çFICOS DO PROJETO
# =============================================================================

# Aliases para navega√ß√£o do projeto
alias pj='cd ${PROJECT_ROOT}'
alias data='cd ${DATA_DIR}'
alias models='cd ${MODELS_DIR}'
alias notebooks='cd ${NOTEBOOKS_DIR}'
alias src='cd ${SRC_DIR}'
alias logs='cd ${LOGS_DIR}'
alias config='cd ${CONFIG_DIR}'

# Aliases para Python e desenvolvimento
alias py='python'
alias pip='uv pip'
alias uv-add='uv add'
alias uv-sync='uv sync'
alias uv-run='uv run'
alias uv-install='uv install'

# Aliases para Jupyter
alias jlab='jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --allow-root'
alias jnotebook='jupyter notebook --ip=0.0.0.0 --port=8888 --no-browser --allow-root'
alias jstop='jupyter notebook stop'

# Aliases para MLflow
alias mlflow-ui='mlflow ui --host 0.0.0.0 --port 5000'
alias mlflow-server='python mlflow_server.py'

# Aliases para TensorBoard
alias tensorboard='tensorboard --logdir=${TENSORBOARD_LOG_DIR} --host=0.0.0.0 --port=6006'

# Aliases para testes
alias test='pytest'
alias test-cov='pytest --cov=src --cov-report=html --cov-report=term'
alias test-fast='pytest -x -q'
alias test-verbose='pytest -v'

# Aliases para qualidade de c√≥digo
alias lint='ruff check src/ tests/'
alias format='ruff format src/ tests/'
alias type-check='mypy src/'
alias security='bandit -r src/'

# Aliases para Git
alias gs='git status'
alias ga='git add'
alias gc='git commit'
alias gp='git push'
alias gl='git log --oneline'
alias gd='git diff'
alias gb='git branch'
alias gco='git checkout'

# Aliases para Docker
alias dbuild='docker build -t ${PROJECT_NAME} .'
alias drun='docker run -it --rm -p 8888:8888 -p 5000:5000 ${PROJECT_NAME}'
alias dstop='docker stop $(docker ps -q)'
alias dclean='docker system prune -f'

# Aliases para limpeza
alias clean-pyc='find . -type f -name "*.pyc" -delete'
alias clean-cache='find . -type d -name "__pycache__" -exec rm -rf {} +'
alias clean-logs='rm -rf ${LOGS_DIR}/*'
alias clean-models='rm -rf ${MODELS_DIR}/*'

# =============================================================================
# üöÄ FUN√á√ïES √öTEIS
# =============================================================================

# Fun√ß√£o para ativar ambiente virtual
activate_venv() {
    if [ -d ".venv" ]; then
        source .venv/bin/activate
        echo "‚úÖ Ambiente virtual ativado"
    else
        echo "‚ùå Ambiente virtual n√£o encontrado. Execute: uv venv"
    fi
}

# Fun√ß√£o para criar ambiente virtual
create_venv() {
    echo "üîß Criando ambiente virtual..."
    uv venv
    source .venv/bin/activate
    echo "üì¶ Instalando depend√™ncias..."
    uv sync
    echo "‚úÖ Ambiente virtual criado e configurado!"
}

# Fun√ß√£o para executar notebooks
run_notebook() {
    local notebook_name=$1
    if [ -z "$notebook_name" ]; then
        echo "üìì Iniciando Jupyter Lab..."
        jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --allow-root
    else
        echo "üìì Executando notebook: $notebook_name"
        jupyter nbconvert --execute --to notebook --inplace "$notebook_name"
    fi
}

# Fun√ß√£o para treinar modelo
train_model() {
    local model_name=${1:-"default"}
    echo "ü§ñ Iniciando treinamento do modelo: $model_name"
    python src/train.py --model_name "$model_name"
}

# Fun√ß√£o para avaliar modelo
evaluate_model() {
    local model_name=${1:-"default"}
    echo "üìä Avaliando modelo: $model_name"
    python src/evaluate.py --model_name "$model_name"
}

# Fun√ß√£o para gerar relat√≥rio
generate_report() {
    echo "üìà Gerando relat√≥rio de an√°lise..."
    python src/report.py
}

# Fun√ß√£o para backup de dados
backup_data() {
    local backup_name="backup_$(date +%Y%m%d_%H%M%S)"
    echo "üíæ Criando backup: $backup_name"
    tar -czf "${backup_name}.tar.gz" data/ models/ logs/
    echo "‚úÖ Backup criado: ${backup_name}.tar.gz"
}

# Fun√ß√£o para limpeza completa
clean_all() {
    echo "üßπ Limpando arquivos tempor√°rios..."
    clean-pyc
    clean-cache
    clean-logs
    echo "‚úÖ Limpeza conclu√≠da!"
}

# Fun√ß√£o para status do projeto
project_status() {
    echo "üõ¢Ô∏è  STATUS DO PROJETO PETROBRAS"
    echo "================================"
    echo "üìÅ Diret√≥rio do projeto: ${PROJECT_ROOT}"
    echo "üêç Python: $(python --version)"
    echo "üì¶ uv: $(uv --version)"
    echo "üìä Jupyter: $(jupyter --version 2>/dev/null || echo 'N√£o instalado')"
    echo "ü§ñ MLflow: $(mlflow --version 2>/dev/null || echo 'N√£o instalado')"
    echo ""
    echo "üìÇ Estrutura de diret√≥rios:"
    echo "  üìä Dados: ${DATA_DIR}"
    echo "  ü§ñ Modelos: ${MODELS_DIR}"
    echo "  üìì Notebooks: ${NOTEBOOKS_DIR}"
    echo "  üîß C√≥digo: ${SRC_DIR}"
    echo "  üìù Logs: ${LOGS_DIR}"
    echo ""
    echo "üåê Servi√ßos dispon√≠veis:"
    echo "  üìì Jupyter Lab: http://localhost:8888"
    echo "  üìä MLflow UI: http://localhost:5000"
    echo "  üìà TensorBoard: http://localhost:6006"
}

# =============================================================================
# üéØ PROMPT PERSONALIZADO
# =============================================================================

# Fun√ß√£o para obter status do Git
git_status() {
    local branch=$(git branch 2>/dev/null | grep '^*' | sed 's/* //')
    if [ -n "$branch" ]; then
        local status=$(git status --porcelain 2>/dev/null)
        if [ -n "$status" ]; then
            echo " %F{red}($branch)%f"
        else
            echo " %F{green}($branch)%f"
        fi
    fi
}

# Fun√ß√£o para obter status do ambiente virtual
venv_status() {
    if [ -n "$VIRTUAL_ENV" ]; then
        local venv_name=$(basename "$VIRTUAL_ENV")
        echo " %F{blue}[$venv_name]%f"
    fi
}

# Configura√ß√£o do prompt
setopt PROMPT_SUBST
PROMPT='%F{cyan}üõ¢Ô∏è %F{yellow}%n%f@%F{green}%m%f %F{blue}%~%f$(git_status)$(venv_status)
%F{red}‚ùØ%f '

# =============================================================================
# üîå PLUGINS E EXTENS√ïES
# =============================================================================

# Configura√ß√£o do Oh My Zsh (se instalado)
if [ -d "$HOME/.oh-my-zsh" ]; then
    export ZSH="$HOME/.oh-my-zsh"
    ZSH_THEME="robbyrussell"
    plugins=(
        git
        python
        pip
        docker
        docker-compose
        jupyter
        conda-zsh-completion
    )
    source $ZSH/oh-my-zsh.sh
fi

# Configura√ß√£o do zsh-autosuggestions (se instalado)
if [ -f "$HOME/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh" ]; then
    source "$HOME/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh"
fi

# Configura√ß√£o do zsh-syntax-highlighting (se instalado)
if [ -f "$HOME/.zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh" ]; then
    source "$HOME/.zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
fi

# =============================================================================
# üöÄ INICIALIZA√á√ÉO
# =============================================================================

# Mensagem de boas-vindas
echo "üõ¢Ô∏è  Bem-vindo ao projeto Petrobras Offshore Wells Anomaly Detection!"
echo "üìä Use 'project_status' para ver o status do projeto"
echo "üîß Use 'create_venv' para configurar o ambiente virtual"
echo "üìì Use 'jlab' para iniciar o Jupyter Lab"
echo ""

# Ativar ambiente virtual se existir
if [ -d ".venv" ]; then
    source .venv/bin/activate
    echo "‚úÖ Ambiente virtual ativado automaticamente"
fi

# =============================================================================
# üìù CONFIGURA√á√ïES ADICIONAIS
# =============================================================================

# Configura√ß√µes de seguran√ßa
umask 022

# Configura√ß√µes de locale
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8

# Configura√ß√µes de editor
export EDITOR='code'
export VISUAL='code'

# Configura√ß√µes de pager
export PAGER='less'
export LESS='-R'

# Configura√ß√µes de fzf (se instalado)
if command -v fzf &> /dev/null; then
    export FZF_DEFAULT_OPTS='--height 40% --layout=reverse --border'
    export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow --exclude .git'
fi

# =============================================================================
# üéâ FINALIZA√á√ÉO
# =============================================================================

# Carregar configura√ß√µes locais se existirem
if [ -f "$HOME/.zshrc.local" ]; then
    source "$HOME/.zshrc.local"
fi

# Carregar configura√ß√µes do projeto se existirem
if [ -f "${PROJECT_ROOT}/.zshrc.project" ]; then
    source "${PROJECT_ROOT}/.zshrc.project"
fi

echo "üéØ Configura√ß√£o do ZSH carregada com sucesso!"
